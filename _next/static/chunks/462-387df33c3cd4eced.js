"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{2840:function(e,s,t){t.d(s,{I:function(){return b}});var r=t(7437),a=t(2265),n=t(9376),l=t(3145),o=t(3260),i=t(2449),c=t(7855),d=t(7648),u=t(1469),h=t(4863);let m=()=>{let e=(0,n.useRouter)(),{user:s,logout:t,hasPermission:m}=(0,i.tN)(),{year:f}=(0,i.GL)(),[x,p]=(0,a.useState)(!1),[b,g]=a.useState(null),v=((null==s?void 0:s.role)||"").toUpperCase(),y="TEACHER"===v||"GUARDIAN"===v||"STUDENT"===v,j=e=>{let s=(e||"").toLowerCase();return({superadmin:"Superadmin",global_admin:"Superadmin",admin:"Administrador",teacher:"Profesor",coordinator:"Coordinador",gestion_escolar:"Gesti\xf3n Escolar",guardian:"Apoderado",student:"Estudiante"})[s]||(s?s.charAt(0).toUpperCase()+s.slice(1):"")},N=m("messages.create"),w=m("messages.list"),E=m("students.create")||m("students.update")||m("students.delete"),S=m("groups.create")||m("groups.update")||m("groups.delete"),C=!y&&(E||S),k=m("reports.view"),A=!y&&(m("users.create")||m("users.delete")||m("schools.manage")),D=(0,a.useMemo)(()=>[{label:"Dashboard",href:"/dashboard",icon:u.m6D},...N?[{label:"Enviar Mensaje",href:"/messages/new",icon:u.EQ9}]:[],...w?[{label:"Historial de Mensajes",href:"/messages",icon:u.EQ9}]:[],...C?[{label:"Estudiantes y Apoderados",href:"/management/students",icon:u.WY8},...S?[{label:"Grupos",href:"/management/groups",icon:u.WY8}]:[]]:[],...k?[{label:"Reportes",href:"/reports",icon:u.orK}]:[],...A?[{label:"Configuraci\xf3n",href:"/settings",icon:u.nbt}]:[]],[N,w,C,S,k,A]);a.useEffect(()=>{(async()=>{if(!(null==s?void 0:s.schoolId)){g(null);return}try{var e;let t=await c.x.getSchoolById(s.schoolId),r=null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.logoUrl;g(r||null)}catch(e){g(null)}})()},[null==s?void 0:s.schoolId]);let I=()=>{localStorage.removeItem("authToken"),t(),e.push("/login")};return(0,r.jsx)("header",{className:"sticky top-0 z-40 bg-transparent",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center h-16 glass-panel rounded-2xl mt-3 px-3 sm:px-4 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[b?(0,r.jsx)("div",{className:"w-11 h-11 rounded-xl overflow-hidden border border-white/60 shadow",children:(0,r.jsx)("img",{src:b,alt:"Logo colegio",className:"w-full h-full object-cover"})}):(0,r.jsx)("div",{className:"w-11 h-11 rounded-xl overflow-hidden border border-primary/30 bg-white shadow",children:(0,r.jsx)(l.default,{src:h.Z,alt:"Notiflow",className:"w-full h-full object-cover",priority:!0})}),(0,r.jsxs)("div",{className:"hidden sm:block",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-secondary",children:"Notiflow"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Mensajer\xeda Escolar"})]})]}),(0,r.jsx)("div",{className:"hidden sm:flex items-center gap-4",children:s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm font-semibold text-secondary",children:s.name}),(0,r.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:j(s.role)}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:s.schoolName||"Colegio ".concat(s.schoolId)})]}),(0,r.jsx)("button",{onClick:I,className:"p-2 text-gray-600 hover:text-red-600 transition-colors",title:"Cerrar sesi\xf3n",children:(0,r.jsx)(u.xqh,{size:20})})]})}),(0,r.jsx)("button",{className:"sm:hidden text-secondary",onClick:()=>p(!x),children:x?(0,r.jsx)(u.q5L,{size:24,className:"text-gray-600"}):(0,r.jsx)(u.cur,{size:24,className:"text-gray-600"})})]}),x&&(0,r.jsx)("div",{className:"sm:hidden pb-4 border-t border-gray-200 pt-4 space-y-4 glass-panel rounded-xl mt-2",children:s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-4 text-sm",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:s.name}),(0,r.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:j(s.role)}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:s.schoolName||"Colegio ".concat(s.schoolId)})]}),(0,r.jsx)("nav",{className:"space-y-2",children:D.map(e=>{let s=e.icon;return(0,r.jsxs)(d.default,{href:e.href,className:"flex items-center gap-2 px-3 py-2 rounded-lg border border-gray-200 hover:border-primary hover:bg-primary/10 text-sm font-medium text-gray-700",onClick:()=>p(!1),children:[(0,r.jsx)(s,{size:16,className:"text-primary"}),(0,r.jsx)("span",{children:e.label})]},e.href)})}),(0,r.jsx)(o.zx,{variant:"danger",size:"sm",fullWidth:!0,onClick:I,children:"Cerrar sesi\xf3n"})]})})]})})};var f=t(1994);let x=()=>{let e=(0,n.usePathname)(),[s,t]=(0,a.useState)(null),l=(0,i.tN)(e=>e.user),o=(0,i.tN)(e=>e.hasPermission),c=((null==l?void 0:l.role)||"").toUpperCase(),h="TEACHER"===c||"GUARDIAN"===c||"STUDENT"===c,m=o("messages.create"),x=o("messages.list"),p=o("students.create")||o("students.update")||o("students.delete"),b=o("groups.create")||o("groups.update")||o("groups.delete"),g=!h&&(p||b),v=!h&&(o("users.create")||o("users.update")),y=o("reports.view"),j=!h&&(o("users.create")||o("users.delete")||o("schools.manage")),N="SUPERADMIN"===c||"ADMIN"===c||"TEACHER"===c||o("events.create"),w=(0,a.useMemo)(()=>[{label:"Dashboard",href:"/dashboard",icon:u.m6D},{label:"Enviar Mensaje",href:"/messages/new",icon:u.EQ9,hidden:!m},{label:"Historial de Mensajes",href:"/messages",icon:u.EQ9,hidden:!x},{label:"Eventos",href:"/events",icon:u.vlc,hidden:!1,badge:N?"Nuevo":void 0},{label:"Gesti\xf3n",icon:u.WY8,hidden:!g,submenu:[...p?[{label:"Estudiantes y Apoderados",href:"/management/students"}]:[],...b?[{label:"Grupos",href:"/management/groups"}]:[],...v?[{label:"Permisos profesores",href:"/management/teacher-permissions"}]:[]]},{label:"Reportes",href:"/reports",icon:u.orK,hidden:!y},{label:"Configuraci\xf3n",href:"/settings",icon:u.nbt,hidden:!j}],[m,x,p,b,g,y,j,N]);return(0,r.jsxs)("aside",{className:"hidden sm:flex sm:flex-col w-64 bg-gradient-to-b from-secondary to-secondary/95 text-white shadow-xl",children:[(0,r.jsx)("div",{className:"px-4 pt-6 pb-3",children:(0,r.jsx)("p",{className:"text-xs uppercase tracking-[0.12em] text-white/60 mb-3",children:"Navegaci\xf3n"})}),(0,r.jsx)("nav",{className:"flex-1 px-4 pb-6 space-y-2 overflow-y-auto",children:w.filter(e=>!e.hidden).map(a=>{let n=a.icon,l=e===a.href,o="submenu"in a;return o?(0,r.jsxs)("div",{children:[(0,r.jsxs)("button",{onClick:()=>t(s===a.label?null:a.label),className:(0,f.Z)("w-full flex items-center justify-between gap-3 px-4 py-2.5 rounded-xl transition-all","hover:bg-white/10 border border-transparent hover:border-white/15","backdrop-blur-sm"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(n,{size:20}),(0,r.jsx)("span",{className:"font-semibold",children:a.label})]}),(0,r.jsx)(u.bTu,{size:16,className:(0,f.Z)("transition-transform",s===a.label&&"rotate-180")})]}),s===a.label&&o&&(0,r.jsx)("div",{className:"ml-4 mt-1 space-y-1",children:a.submenu&&a.submenu.map(s=>(0,r.jsx)(d.default,{href:s.href,className:(0,f.Z)("block px-4 py-2 rounded-lg text-sm transition-colors backdrop-blur-sm",e===s.href?"bg-white text-secondary font-semibold shadow-sm":"hover:bg-white/10"),children:s.label},s.href))})]},a.label):(0,r.jsxs)(d.default,{href:a.href||"#",className:(0,f.Z)("flex items-center gap-3 px-4 py-2.5 rounded-xl font-semibold transition-all text-white backdrop-blur-sm border border-transparent",l?"bg-white text-secondary shadow-lg":"hover:bg-white/10 hover:border-white/20"),children:[(0,r.jsx)(n,{size:20}),(0,r.jsx)("span",{children:a.label}),a.badge&&(0,r.jsx)("span",{className:"ml-auto text-[10px] px-2 py-0.5 rounded-full bg-primary text-secondary font-bold uppercase tracking-wide",children:a.badge})]},a.href)})})]})},p=e=>{let{children:s}=e;return(0,r.jsxs)("div",{className:"app-shell flex flex-col min-h-screen",children:[(0,r.jsx)(m,{}),(0,r.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,r.jsx)(x,{}),(0,r.jsx)("main",{className:"flex-1 overflow-y-auto bg-gradient-to-br from-white/60 via-white/70 to-white/60",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-10 space-y-6",children:s})})]})]})},b=e=>{let{children:s}=e,t=(0,n.useRouter)(),{user:l,setUser:o}=(0,i.tN)(),[d,u]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{if(!localStorage.getItem("authToken")){u(!1),t.replace("/login");return}if(l){u(!1);return}c.x.getAuthMe().then(e=>{(null==e?void 0:e.data)&&o(e.data)}).catch(()=>{localStorage.removeItem("authToken"),o(null),t.replace("/login")}).finally(()=>u(!1))},[t,o,l]),d)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/10 via-white to-secondary/5 text-secondary",children:(0,r.jsx)("div",{className:"glass-panel px-6 py-4 rounded-2xl text-sm font-semibold shadow-lg",children:"Validando sesi\xf3n..."})}):(0,r.jsx)(p,{children:s})}},4369:function(e,s,t){var r=t(2265),a="function"==typeof Object.is?Object.is:function(e,s){return e===s&&(0!==e||1/e==1/s)||e!=e&&s!=s},n=r.useState,l=r.useEffect,o=r.useLayoutEffect,i=r.useDebugValue;function c(e){var s=e.getSnapshot;e=e.value;try{var t=s();return!a(e,t)}catch(e){return!0}}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,s){return s()}:function(e,s){var t=s(),r=n({inst:{value:t,getSnapshot:s}}),a=r[0].inst,d=r[1];return o(function(){a.value=t,a.getSnapshot=s,c(a)&&d({inst:a})},[e,t,s]),l(function(){return c(a)&&d({inst:a}),e(function(){c(a)&&d({inst:a})})},[e]),i(t),t};s.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:d},2860:function(e,s,t){var r=t(2265),a=t(2558),n="function"==typeof Object.is?Object.is:function(e,s){return e===s&&(0!==e||1/e==1/s)||e!=e&&s!=s},l=a.useSyncExternalStore,o=r.useRef,i=r.useEffect,c=r.useMemo,d=r.useDebugValue;s.useSyncExternalStoreWithSelector=function(e,s,t,r,a){var u=o(null);if(null===u.current){var h={hasValue:!1,value:null};u.current=h}else h=u.current;var m=l(e,(u=c(function(){function e(e){if(!i){if(i=!0,l=e,e=r(e),void 0!==a&&h.hasValue){var s=h.value;if(a(s,e))return o=s}return o=e}if(s=o,n(l,e))return s;var t=r(e);return void 0!==a&&a(s,t)?(l=e,s):(l=e,o=t)}var l,o,i=!1,c=void 0===t?null:t;return[function(){return e(s())},null===c?void 0:function(){return e(c())}]},[s,t,r,a]))[0],u[1]);return i(function(){h.hasValue=!0,h.value=m},[m]),d(m),m}},2558:function(e,s,t){e.exports=t(4369)},5195:function(e,s,t){e.exports=t(2860)},1994:function(e,s,t){s.Z=function(){for(var e,s,t=0,r="",a=arguments.length;t<a;t++)(e=arguments[t])&&(s=function e(s){var t,r,a="";if("string"==typeof s||"number"==typeof s)a+=s;else if("object"==typeof s){if(Array.isArray(s)){var n=s.length;for(t=0;t<n;t++)s[t]&&(r=e(s[t]))&&(a&&(a+=" "),a+=r)}else for(r in s)s[r]&&(a&&(a+=" "),a+=r)}return a}(e))&&(r&&(r+=" "),r+=s);return r}},9625:function(e,s,t){t.d(s,{Ue:function(){return h}});let r=e=>{let s;let t=new Set,r=(e,r)=>{let a="function"==typeof e?e(s):e;if(!Object.is(a,s)){let e=s;s=(null!=r?r:"object"!=typeof a||null===a)?a:Object.assign({},s,a),t.forEach(t=>t(s,e))}},a=()=>s,n={setState:r,getState:a,getInitialState:()=>l,subscribe:e=>(t.add(e),()=>t.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},l=s=e(r,a,n);return n},a=e=>e?r(e):r;var n=t(2265),l=t(5195);let{useDebugValue:o}=n,{useSyncExternalStoreWithSelector:i}=l,c=!1,d=e=>e,u=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let s="function"==typeof e?a(e):e,t=(e,t)=>(function(e,s=d,t){t&&!c&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),c=!0);let r=i(e.subscribe,e.getState,e.getServerState||e.getInitialState,s,t);return o(r),r})(s,e,t);return Object.assign(t,s),t},h=e=>e?u(e):u}}]);