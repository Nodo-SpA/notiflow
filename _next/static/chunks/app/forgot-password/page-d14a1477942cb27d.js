(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[781],{7782:function(e,t,r){Promise.resolve().then(r.bind(r,9153))},9153:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var s=r(7437),n=r(2265),a=r(7648),o=r(7855),i=r(1469);function c(){let[e,t]=(0,n.useState)(""),[r,c]=(0,n.useState)(""),[l,u]=(0,n.useState)(""),[d,h]=(0,n.useState)(!1),[p,m]=(0,n.useState)("request"),[g,y]=(0,n.useState)(""),[f,v]=(0,n.useState)(""),[x,b]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=new URLSearchParams(window.location.search).get("token");e&&(c(e),m("reset"),y("Ingresa tu nueva contrase\xf1a para completar el cambio."))},[]);let w=async t=>{var r,s,n,a,i;t.preventDefault(),b(!0),v(""),y("");try{let t=await o.x.forgotPassword(e),s=null===(r=t.data)||void 0===r?void 0:r.token;y(s?"Token generado. (Demo) C\xf3pielo para resetear: ".concat(s):"Revisa tu correo para continuar con el reseteo."),s&&(c(s),m("reset"))}catch(e){v((null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.message)||(null==e?void 0:null===(i=e.response)||void 0===i?void 0:null===(a=i.data)||void 0===a?void 0:a.error)||(null==e?void 0:e.message)||"No se pudo generar el enlace de recuperaci\xf3n")}finally{b(!1)}},S=async e=>{e.preventDefault(),b(!0),v(""),y("");try{await o.x.resetPassword(r,l),y("Contrase\xf1a actualizada. Ahora puedes iniciar sesi\xf3n."),m("request"),c(""),u(""),t("")}catch(e){var s,n,a,i;v((null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.message)||(null==e?void 0:null===(i=e.response)||void 0===i?void 0:null===(a=i.data)||void 0===a?void 0:a.error)||(null==e?void 0:e.message)||"No se pudo resetear la contrase\xf1a")}finally{b(!1)}};return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary to-secondary flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"w-full max-w-lg space-y-6 bg-white/90 backdrop-blur rounded-2xl p-6 shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Recuperar acceso"}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Recuperar contrase\xf1a"})]}),(0,s.jsx)(a.default,{href:"/login",className:"text-primary hover:text-green-800 text-sm",children:"â† Volver al login"})]}),f&&(0,s.jsx)("div",{className:"p-3 rounded-lg border border-red-200 bg-red-50 text-sm text-red-700",children:f}),g&&(0,s.jsx)("div",{className:"p-3 rounded-lg border border-primary/30 bg-primary/10 text-sm text-primary",children:g}),"request"===p?(0,s.jsxs)("form",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm space-y-4",onSubmit:w,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Correo electr\xf3nico"}),(0,s.jsx)("input",{type:"email",value:e,onChange:e=>t(e.target.value),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",placeholder:"tu@escuela.com",required:!0})]}),(0,s.jsx)("button",{type:"submit",disabled:x,className:"w-full px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors disabled:opacity-60",children:x?"Enviando...":"Enviar enlace de recuperaci\xf3n"})]}):(0,s.jsxs)("form",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm space-y-4",onSubmit:S,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nueva contrase\xf1a"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:d?"text":"password",value:l,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200 pr-10",required:!0}),(0,s.jsx)("button",{type:"button",onClick:()=>h(e=>!e),className:"absolute inset-y-0 right-2 flex items-center text-gray-500 hover:text-primary","aria-label":"Mostrar contrase\xf1a",children:d?(0,s.jsx)(i.rzC,{size:18}):(0,s.jsx)(i.rDJ,{size:18})})]})]}),(0,s.jsx)("button",{type:"submit",disabled:x,className:"w-full px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors disabled:opacity-60",children:x?"Actualizando...":"Actualizar contrase\xf1a"})]})]})})}},7855:function(e,t,r){"use strict";r.d(t,{x:function(){return a}});var s=r(3464);class n{async getTeacherPermissions(){return this.client.get("/teacher-permissions")}async updateTeacherPermission(e,t){return this.client.put("/teacher-permissions/".concat(encodeURIComponent(e)),t)}async login(e,t){return this.client.post("/auth/login",{email:e,password:t})}async refresh(e){return this.client.post("/auth/refresh",{refreshToken:e})}async getAuthMe(){return this.client.get("/auth/me")}async logout(){return this.client.post("/auth/logout")}async sendMessage(e){return this.client.post("/messages",e,{timeout:12e4})}async getTemplates(){return this.client.get("/templates")}async createTemplate(e){return this.client.post("/templates",e)}async updateTemplate(e,t){return this.client.put("/templates/".concat(e),t)}async deleteTemplate(e){return this.client.delete("/templates/".concat(e))}async getUsageMetrics(){return this.client.get("/reports/usage")}async getMessages(e){return this.client.get("/messages",{params:e})}async getMessageById(e){return this.client.get("/messages/".concat(e))}async deleteMessage(e){return this.client.delete("/messages/".concat(e))}async getStudents(e){return this.client.get("/students",{params:e})}async createStudent(e){return this.client.post("/students",e)}async updateStudent(e,t){return this.client.put("/students/".concat(e),t)}async getSchoolData(){return this.client.get("/school")}async getSchoolById(e){return this.client.get("/schools/".concat(e))}async updateSchool(e,t){return this.client.put("/schools/".concat(e),t)}async createSchool(e){return this.client.post("/schools",e)}async uploadSchoolLogo(e,t){let r=new FormData;return r.append("file",t),this.client.post("/schools/".concat(e,"/logo"),r,{headers:{"Content-Type":"multipart/form-data"}})}async getCourses(e){return this.client.get("/courses",{params:{levelId:e}})}async getLevels(){return this.client.get("/levels")}async getCurrentUser(){return this.client.get("/auth/me")}async getUsers(e){return this.client.get("/users",{params:"string"==typeof e?{role:e}:e})}async createUser(e){return this.client.post("/users",e)}async updateUser(e,t){return this.client.put("/users/".concat(e),t)}async deleteUser(e){return this.client.delete("/users/".concat(e))}async requestOtp(e){return this.client.post("/auth/otp/request",{email:e})}async verifyOtp(e,t,r,s){return this.client.post("/auth/otp/verify",{email:e,code:t,studentId:r,studentsOnly:null!=s&&s})}async getSchools(){return this.client.get("/schools")}async getGroups(e,t,r,s,n){return this.client.get("/groups",{params:{schoolId:e,year:t,q:r,page:s,pageSize:n}})}async getEvents(e){return this.client.get("/events",{params:e})}async createEvent(e){return this.client.post("/events",e)}async deleteEvent(e){return this.client.delete("/events/".concat(e))}async createGroup(e){return this.client.post("/groups",e)}async updateGroup(e,t){return this.client.put("/groups/".concat(e),t)}async deleteGroup(e){return this.client.delete("/groups/".concat(e))}async forgotPassword(e){return this.client.post("/auth/forgot",{email:e})}async resetPassword(e,t){return this.client.post("/auth/reset",{token:e,newPassword:t})}async aiRewriteModerate(e,t,r){return this.client.post("/ai/rewrite-moderate",{text:e,subject:t,tone:r},{timeout:6e4})}async getAiPolicy(){return this.client.get("/ai/policy")}async updateAiPolicy(e){return this.client.put("/ai/policy",e)}async importStudentsCsv(e,t){let r=new FormData;return r.append("file",e),r.append("schoolId",t),this.client.post("/import/students",r,{headers:{"Content-Type":"multipart/form-data"},timeout:18e4})}constructor(){this.isRefreshing=!1,this.refreshPromise=null,this.client=s.Z.create({baseURL:"https://notiflow-backend-179964029864.us-central1.run.app",timeout:45e3,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{let t=localStorage.getItem("authToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),this.client.interceptors.response.use(e=>e,e=>{var t;let r=e.config;if(401===(null===(t=e.response)||void 0===t?void 0:t.status)){let t=localStorage.getItem("refreshToken");return t?this.isRefreshing&&this.refreshPromise?this.refreshPromise.then(()=>(r.headers=r.headers||{},r.headers.Authorization="Bearer ".concat(localStorage.getItem("authToken")),this.client(r))):(this.isRefreshing=!0,this.refreshPromise=this.refresh(t).then(e=>{let{token:t,refreshToken:s}=e.data||{};return t&&localStorage.setItem("authToken",t),s&&localStorage.setItem("refreshToken",s),r.headers=r.headers||{},r.headers.Authorization="Bearer ".concat(t),this.client(r)}).catch(e=>(localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),window.location.href="/login",Promise.reject(e))).finally(()=>{this.isRefreshing=!1,this.refreshPromise=null}),this.refreshPromise):(localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),window.location.href="/login",Promise.reject(e))}return Promise.reject(e)})}}let a=new n}},function(e){e.O(0,[502,619,648,971,117,744],function(){return e(e.s=7782)}),_N_E=e.O()}]);