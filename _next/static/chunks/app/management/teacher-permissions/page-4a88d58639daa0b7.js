(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[467],{5345:function(e,s,r){Promise.resolve().then(r.bind(r,5321))},5321:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return n}});var a=r(7437),t=r(2265),l=r(7648),o=r(2840),i=r(7855),d=r(2449);function n(){(0,d.tN)(e=>e.user);let e=(0,d.tN)(e=>e.hasPermission),s=e("users.create")||e("users.update"),[r,n]=(0,t.useState)([]),[c,u]=(0,t.useState)([]),[m,x]=(0,t.useState)({}),[p,h]=(0,t.useState)(!1),[g,v]=(0,t.useState)(""),[f,b]=(0,t.useState)(null),[y,N]=(0,t.useState)(""),[j,w]=(0,t.useState)("");(0,t.useEffect)(()=>{s&&(async()=>{var e,s,r,a,t,l,o;h(!0),v("");try{let[a,t,l]=await Promise.all([i.x.getUsers({role:"teacher"}),i.x.getGroups(),null===(e=i.x.getTeacherPermissions)||void 0===e?void 0:e.call(i.x)]),o=(a.data||[]).filter(e=>"teacher"===(e.role||"").toLowerCase());n(o);let d=t.data||[];u(null!==(r=null!==(s=d.items)&&void 0!==s?s:d)&&void 0!==r?r:[]);let c=(null==l?void 0:l.data)||[],m={};c.forEach(e=>{m[e.email.toLowerCase()]=e.allowedGroupIds||[]}),x(m)}catch(e){v((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||(null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(l=o.data)||void 0===l?void 0:l.error)||(null==e?void 0:e.message)||"No se pudieron cargar los datos")}finally{h(!1)}})()},[s]);let C=(0,t.useMemo)(()=>{if(!y.trim())return r;let e=y.toLowerCase();return r.filter(s=>(s.name||"").toLowerCase().includes(e)||(s.email||"").toLowerCase().includes(e))},[r,y]),S=(e,s)=>{let r=e.toLowerCase();x(e=>{let a=e[r]||[],t=a.includes(s)?a.filter(e=>e!==s):[...a,s];return{...e,[r]:t}})},L=async e=>{var s,a,t,l,o,d;b(e),v(""),w("");try{let t=m[e.toLowerCase()]||[];await (null===(s=i.x.updateTeacherPermission)||void 0===s?void 0:s.call(i.x,e,{email:e,allowedGroupIds:t}));let l=(null===(a=r.find(s=>s.email.toLowerCase()===e.toLowerCase()))||void 0===a?void 0:a.name)||e;w("Se guardaron los accesos del profesor ".concat(l,".")),setTimeout(()=>w(""),3e3)}catch(e){v((null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(t=l.data)||void 0===t?void 0:t.message)||(null==e?void 0:null===(d=e.response)||void 0===d?void 0:null===(o=d.data)||void 0===o?void 0:o.error)||(null==e?void 0:e.message)||"No se pudo guardar")}finally{b(null)}};return s?(0,a.jsx)(o.I,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Gesti\xf3n escolar"}),(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Permisos profesores"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Define qu\xe9 cursos/grupos puede usar cada profesor al enviar mensajes."})]}),(0,a.jsx)(l.default,{href:"/dashboard",className:"text-primary hover:text-green-800 transition-colors",children:"â† Volver al dashboard"})]}),j&&(0,a.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 text-green-800 rounded text-sm",children:j}),g&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 text-red-700 rounded text-sm",children:g}),(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Profesores"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Selecciona los grupos permitidos por profesor."})]}),(0,a.jsx)("input",{type:"search",value:y,onChange:e=>N(e.target.value),placeholder:"Buscar por nombre o email",className:"w-full sm:w-80 px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200"})]}),p&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Cargando..."}),!p&&(0,a.jsxs)("div",{className:"space-y-4",children:[C.map(e=>{let s=m[e.email.toLowerCase()]||[];return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:e.name||e.email}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.email})]}),(0,a.jsx)("button",{type:"button",onClick:()=>L(e.email),disabled:f===e.email,className:"px-3 py-1.5 text-xs bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50",children:f===e.email?"Guardando...":"Guardar"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[c.map(r=>{let t=s.includes(r.id);return(0,a.jsx)("button",{type:"button",onClick:()=>S(e.email,r.id),className:"px-3 py-1.5 rounded-full border text-xs transition ".concat(t?"bg-primary text-white border-primary":"border-gray-200 text-gray-700 hover:border-primary"),children:r.name},r.id)}),0===c.length&&(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"No hay grupos."})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:[s.length," grupo(s) permitidos"]})]},e.id)}),!C.length&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No hay profesores para este colegio."})]})]})]})}):(0,a.jsx)(o.I,{children:(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Sin permisos"}),(0,a.jsx)("p",{className:"text-gray-600",children:"No tienes permisos para gestionar permisos de profesores."})]})})}}},function(e){e.O(0,[502,619,648,785,255,462,971,117,744],function(){return e(e.s=5345)}),_N_E=e.O()}]);