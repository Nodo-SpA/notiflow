(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{2965:function(e,a,s){Promise.resolve().then(s.bind(s,1856))},1856:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return u}});var r=s(7437),l=s(2265),t=s(7648),o=s(2840),i=s(7855),n=s(2449),d=s(1469),c=s(3260);function u(){let e=(0,n.tN)(e=>e.user),a=(0,n.tN)(e=>e.hasPermission),s=a("users.create")||a("users.delete")||a("users.update"),u=a("users.update"),m=a("schools.manage"),x=s||m,p=a("users.delete"),g=a("users.create"),h="global"===((null==e?void 0:e.schoolId)||"").toLowerCase(),[v,y]=(0,l.useState)([]),[f,b]=(0,l.useState)([]),[j,N]=(0,l.useState)(!1),[C,w]=(0,l.useState)(!1),[S,I]=(0,l.useState)(""),[k,A]=(0,l.useState)({name:"",email:"",role:"TEACHER",schoolId:"",schoolName:"",rut:""}),[E,R]=(0,l.useState)({id:"",name:"",currentYear:"",logoUrl:""}),[U,T]=(0,l.useState)(null),[O,P]=(0,l.useState)(null),[D,L]=(0,l.useState)({fileName:"",rows:0}),[Y,z]=(0,l.useState)([]),[V,_]=(0,l.useState)(!1),[B,G]=(0,l.useState)(!1),[M,q]=(0,l.useState)(!1),[H,K]=(0,l.useState)(""),[W,F]=(0,l.useState)(null),[J,Q]=(0,l.useState)(!1),[X,Z]=(0,l.useState)(null),[$,ee]=(0,l.useState)({rewritePrompt:"",moderationRules:"",updatedBy:"",updatedAt:""}),[ea,es]=(0,l.useState)(null),[er,el]=(0,l.useState)(""),[et,eo]=(0,l.useState)(null),[ei,en]=(0,l.useState)(""),[ed,ec]=(0,l.useState)(!1),[eu,em]=(0,l.useState)(!1),[ex,ep]=(0,l.useState)(!1),[eg,eh]=(0,l.useState)(!1),[ev,ey]=(0,l.useState)(!1),[ef,eb]=(0,l.useState)(!1),[ej,eN]=(0,l.useState)(!1),[eC,ew]=(0,l.useState)(!1),[eS,eI]=(0,l.useState)(!1),[ek,eA]=(0,l.useState)(null),[eE,eR]=(0,l.useState)(""),[eU,eT]=(0,l.useState)(1),[eO,eP]=(0,l.useState)(""),eD="Mejora la redacci\xf3n del siguiente mensaje manteniendo el significado.\nAd\xe1ptalo a un tono {tone}, claro y respetuoso. Devuelve solo el texto mejorado sin marcas adicionales.\nMensaje original:\n{texto}",eL="Discurso de odio o racismo\nPol\xedtica partidista\nViolencia o acoso\nInformaci\xf3n sensible no acad\xe9mica",eY=(0,l.useMemo)(()=>[{value:"ADMIN",label:"Admin"},{value:"COORDINATOR",label:"Gesti\xf3n escolar"},{value:"TEACHER",label:"Profesor"}],[]),ez=e=>{let a=e.replace(/[^0-9kK]/g,"").toUpperCase();if(!a)return"";let s=a.slice(0,-1),r=a.slice(-1),l=s.split("").reverse().reduce((e,a,s)=>(0!==s&&s%3==0&&e.push("."),e.push(a),e),[]).reverse().join("");return"".concat(l,"-").concat(r)};(0,l.useEffect)(()=>{x&&(s&&eV(H),m&&eM(),m&&e_())},[x,m,s,m]),(0,l.useEffect)(()=>{h&&""===ei&&f.length>0&&en((f.find(e=>"13376"===e.id)||f[0]).id)},[h,ei,f]),(0,l.useEffect)(()=>{s&&!h&&(null==e?void 0:e.schoolId)&&A(a=>({...a,schoolId:e.schoolId,schoolName:e.schoolName||""}))},[s,h,e]),(0,l.useEffect)(()=>{eT(1)},[H]),(0,l.useEffect)(()=>{let e=setTimeout(()=>eP(H.trim()),300);return()=>clearTimeout(e)},[H]),(0,l.useEffect)(()=>{s&&eV(eO)},[eO,s]);let eV=async e=>{N(!0),I("");try{let a=await i.x.getUsers(e?{q:e}:void 0);y(a.data||[])}catch(e){var a,s,r,l;I((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||(null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.error)||(null==e?void 0:e.message)||"No se pudo cargar usuarios")}finally{N(!1)}},e_=async()=>{ec(!0),I(""),eR("");try{let e=(await i.x.getAiPolicy()).data;ee({rewritePrompt:e.rewritePrompt||eD,moderationRules:(e.moderationRules||[]).join("\n")||eL,updatedBy:e.updatedBy||"",updatedAt:e.updatedAt||""})}catch(l){var e,a,s,r;I((null==l?void 0:null===(a=l.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||(null==l?void 0:null===(r=l.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||(null==l?void 0:l.message)||"No se pudo cargar la pol\xedtica de IA")}finally{ec(!1)}},eB=async e=>{e.preventDefault(),em(!0),I(""),eR("");try{let e=$.moderationRules.split("\n").map(e=>e.trim()).filter(Boolean);await i.x.updateAiPolicy({rewritePrompt:$.rewritePrompt,moderationRules:e}),eR("Pol\xedtica de IA guardada correctamente.")}catch(e){var a,s,r,l;I((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||(null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.error)||(null==e?void 0:e.message)||"No se pudo guardar la pol\xedtica de IA")}finally{em(!1)}},eG=async e=>{if(e.preventDefault(),!et){el("Selecciona un archivo CSV.");return}if(!ei){el("Selecciona el colegio destino.");return}ep(!0),el(""),es(null);try{let e=await i.x.importStudentsCsv(et,ei);es(e.data)}catch(e){var a,s,r,l;el((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||(null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.error)||(null==e?void 0:e.message)||"No se pudo importar el CSV")}finally{ep(!1)}},eM=async()=>{w(!0),I("");try{let e=await i.x.getSchools();b(e.data||[])}catch(l){var e,a,s,r;I((null==l?void 0:null===(a=l.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||(null==l?void 0:null===(r=l.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||(null==l?void 0:l.message)||"No se pudo cargar escuelas")}finally{w(!1)}},eq=async e=>{var a,s,r,l,t,o,n,d;e.preventDefault(),G(!0),I("");try{if(!E.id||!E.name){I("Completa ID y nombre de la escuela"),G(!1);return}if(await i.x.createSchool({id:E.id.trim(),name:E.name.trim(),currentYear:E.currentYear||void 0,logoUrl:E.logoUrl||void 0}),ek)try{let e=await i.x.uploadSchoolLogo(E.id.trim(),ek);R(a=>{var s;return{...a,logoUrl:(null===(s=e.data)||void 0===s?void 0:s.logoUrl)||a.logoUrl}})}catch(t){let e=(null==t?void 0:null===(s=t.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||(null==t?void 0:null===(l=t.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.error)||(null==t?void 0:t.message)||"Colegio creado, pero no se pudo subir el logo";I(e)}finally{eA(null)}R({id:"",name:"",currentYear:"",logoUrl:""}),await eM()}catch(e){I((null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.message)||(null==e?void 0:null===(d=e.response)||void 0===d?void 0:null===(n=d.data)||void 0===n?void 0:n.error)||(null==e?void 0:e.message)||"No se pudo crear la escuela")}finally{G(!1)}},eH=async()=>{if(U&&O){G(!0),I("");try{let e=(await i.x.uploadSchoolLogo(U.id,O)).data;T({id:e.id,name:e.name,currentYear:e.currentYear,logoUrl:e.logoUrl}),await eM(),P(null)}catch(l){var e,a,s,r;I((null==l?void 0:null===(a=l.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||(null==l?void 0:null===(r=l.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||(null==l?void 0:l.message)||"No se pudo subir el logo")}finally{G(!1)}}},eK=e=>{let a=e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean);if(!a.length)return[];let[s,...r]=a,l=s.split(",").map(e=>e.trim().toLowerCase()),t={name:l.indexOf("name"),email:l.indexOf("email"),role:l.indexOf("role"),rut:l.indexOf("rut")};if(-1===t.name||-1===t.email||-1===t.role||-1===t.rut)throw Error("CSV debe tener columnas: name,email,role,rut");return r.map(e=>{let a=e.split(",").map(e=>e.trim()),s=(a[t.role]||"TEACHER").toUpperCase();return{name:a[t.name]||"",email:a[t.email]||"",role:"DIRECTOR"===s?"COORDINATOR":s,rut:a[t.rut]||""}})},eW=async e=>{if(!e)return;let a=await e.text();try{let s=eK(a);z(s),L({fileName:e.name,rows:s.length})}catch(e){I(e.message||"Error al leer CSV")}},eF=async a=>{var r,l,t,o,n;if(a.preventDefault(),s){if(!Y.length){I("Sube un CSV v\xe1lido antes de importar");return}q(!0),I("");try{let a=h?E.id||k.schoolId:(null==e?void 0:e.schoolId)||k.schoolId,s=h?E.name||k.schoolName||(null===(r=f.find(e=>e.id===a))||void 0===r?void 0:r.name)||"":(null==e?void 0:e.schoolName)||k.schoolName;if(!a){I("Define el colegio (ID) para importar usuarios");return}if(h&&E.id&&E.name)try{await i.x.createSchool({id:E.id,name:E.name}),await eM()}catch(e){}for(let e of Y){if(!e.email||!e.name||!e.rut)continue;let r="DIRECTOR"===(e.role||"").toUpperCase()?"COORDINATOR":e.role||"TEACHER";await i.x.createUser({name:e.name,email:e.email,role:r,rut:e.rut,schoolId:a,schoolName:s||"Colegio"})}await eV(),z([]),L({fileName:"",rows:0})}catch(e){I((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(l=t.data)||void 0===l?void 0:l.message)||(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.error)||(null==e?void 0:e.message)||"Error al importar CSV")}finally{q(!1)}}},eJ=e=>{I(""),F(e)},eQ=async()=>{if(p&&W){Q(!0),I("");try{await i.x.deleteUser(W.id),await eV(),F(null)}catch(l){var e,a,s,r;I((null==l?void 0:null===(a=l.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||(null==l?void 0:null===(r=l.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||(null==l?void 0:l.message)||"No se pudo eliminar el usuario")}finally{Q(!1)}}},eX=(0,l.useMemo)(()=>{if(!H.trim())return v;let e=H.toLowerCase();return v.filter(a=>{var s,r,l,t,o;return(null===(s=a.name)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(r=a.email)||void 0===r?void 0:r.toLowerCase().includes(e))||(null===(l=a.role)||void 0===l?void 0:l.toLowerCase().includes(e))||(null===(t=a.schoolName)||void 0===t?void 0:t.toLowerCase().includes(e))||(null===(o=a.rut)||void 0===o?void 0:o.toLowerCase().includes(e))})},[H,v]),eZ=Math.max(1,Math.ceil(eX.length/10)),e$=(0,l.useMemo)(()=>{let e=(eU-1)*10;return eX.slice(e,e+10)},[eX,eU,10]),e0=async a=>{var s,r,l,t,o;if(a.preventDefault(),g||u){_(!0),I("");try{let a=h?k.schoolId:(null==e?void 0:e.schoolId)||k.schoolId,r=h?k.schoolName||(null===(s=f.find(e=>e.id===k.schoolId))||void 0===s?void 0:s.name)||"":(null==e?void 0:e.schoolName)||k.schoolName;if(!a){I("Selecciona una escuela");return}if(!k.rut){I("Ingresa el RUT");return}X?await i.x.updateUser(X.id,{name:k.name,email:k.email,role:k.role,rut:k.rut,schoolId:a,schoolName:r||"Colegio"}):await i.x.createUser({name:k.name,email:k.email,role:k.role,rut:k.rut,schoolId:a,schoolName:r||"Colegio"}),A({name:"",email:"",role:"TEACHER",rut:"",schoolId:h?"":a,schoolName:h?"":r}),Z(null),await eV()}catch(e){I((null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)||(null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.error)||(null==e?void 0:e.message)||"No se pudo crear el usuario")}finally{_(!1)}}};return x?(0,r.jsxs)(o.I,{children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Preferencias"}),(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Configuraci\xf3n"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Gestiona la configuraci\xf3n de tu instituci\xf3n"})]}),(0,r.jsx)(t.default,{href:"/dashboard",className:"text-primary hover:text-green-800 transition-colors",children:"← Volver al dashboard"})]}),S&&(0,r.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm",children:S}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:[s&&(0,r.jsxs)("button",{type:"button",onClick:()=>eh(!0),className:"group glass-panel rounded-2xl p-5 text-left soft-shadow hover:translate-y-[-2px] transition-all flex items-start gap-3",children:[(0,r.jsx)("div",{className:"p-2.5 bg-primary/10 rounded-lg text-primary",children:(0,r.jsx)(d.WY8,{size:20})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Usuarios y roles"}),(0,r.jsx)(d.Tfp,{className:"text-gray-400 group-hover:text-primary"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Alta/baja y permisos del equipo"})]})]}),m&&h&&(0,r.jsxs)("button",{type:"button",onClick:()=>ey(!0),className:"group glass-panel rounded-2xl p-5 text-left soft-shadow hover:translate-y-[-2px] transition-all flex items-start gap-3",children:[(0,r.jsx)("div",{className:"p-2.5 bg-primary/10 rounded-lg text-primary",children:(0,r.jsx)(d.m6D,{size:20})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Colegios"}),(0,r.jsx)(d.Tfp,{className:"text-gray-400 group-hover:text-primary"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Identidad, logos y a\xf1o acad\xe9mico"})]})]}),s&&(0,r.jsxs)("button",{type:"button",onClick:()=>eN(!0),className:"group glass-panel rounded-2xl p-5 text-left soft-shadow hover:translate-y-[-2px] transition-all flex items-start gap-3",children:[(0,r.jsx)("div",{className:"p-2.5 bg-primary/10 rounded-lg text-primary",children:(0,r.jsx)(d.Yjd,{size:20})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Importar usuarios"}),(0,r.jsx)(d.Tfp,{className:"text-gray-400 group-hover:text-primary"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Carga masiva desde CSV"})]})]}),h&&(0,r.jsxs)("button",{type:"button",onClick:()=>ew(!0),className:"group glass-panel rounded-2xl p-5 text-left soft-shadow hover:translate-y-[-2px] transition-all flex items-start gap-3",children:[(0,r.jsx)("div",{className:"p-2.5 bg-primary/10 rounded-lg text-primary",children:(0,r.jsx)(d.bGz,{size:20})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Importar estudiantes"}),(0,r.jsx)(d.Tfp,{className:"text-gray-400 group-hover:text-primary"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Superadmin: CSV con generaci\xf3n de grupos"})]})]}),m&&(0,r.jsxs)("button",{type:"button",onClick:()=>eb(!0),className:"group glass-panel rounded-2xl p-5 text-left soft-shadow hover:translate-y-[-2px] transition-all flex items-start gap-3",children:[(0,r.jsx)("div",{className:"p-2.5 bg-primary/10 rounded-lg text-primary",children:(0,r.jsx)(d.Par,{size:20})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Pol\xedtica de IA"}),(0,r.jsx)(d.Tfp,{className:"text-gray-400 group-hover:text-primary"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Prompt y reglas de moderaci\xf3n"})]})]})]})]}),(0,r.jsx)(c.u_,{isOpen:eg,title:"Usuarios y roles",onClose:()=>eh(!1),cancelText:"Cerrar",size:"xl",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(g||u)&&(0,r.jsxs)("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 border border-gray-100 rounded-lg p-4",onSubmit:e0,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),(0,r.jsx)("input",{type:"text",value:k.name,onChange:e=>A(a=>({...a,name:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,r.jsx)("input",{type:"email",value:k.email,onChange:e=>A(a=>({...a,email:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RUT"}),(0,r.jsx)("input",{type:"text",value:k.rut,onChange:e=>A(a=>({...a,rut:ez(e.target.value)})),placeholder:"12.345.678-9",className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rol"}),(0,r.jsx)("select",{value:k.role,onChange:e=>A(a=>({...a,role:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200 bg-white",children:eY.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Colegio"}),h?(0,r.jsxs)("select",{value:k.schoolId,onChange:e=>A(a=>({...a,schoolId:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200 bg-white",children:[(0,r.jsx)("option",{value:"",children:"Selecciona colegio"}),f.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," (",e.id,")"]},e.id))]}):(0,r.jsx)("input",{type:"text",value:(null==e?void 0:e.schoolName)||(null==e?void 0:e.schoolId)||"",disabled:!0,className:"w-full px-3 py-2 border rounded-lg text-sm bg-gray-100 text-gray-600"})]}),h&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del colegio"}),(0,r.jsx)("input",{type:"text",value:k.schoolName,onChange:e=>A(a=>({...a,schoolName:e.target.value})),placeholder:"Solo si el colegio no est\xe1 en la lista",className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200"})]}),(0,r.jsxs)("div",{className:"md:col-span-2 flex items-center justify-end gap-3",children:[X&&(0,r.jsx)("button",{type:"button",onClick:()=>{Z(null),A({name:"",email:"",role:"TEACHER",rut:"",schoolId:h?"":(null==e?void 0:e.schoolId)||"",schoolName:h?"":(null==e?void 0:e.schoolName)||""})},className:"px-3 py-2 border border-gray-300 rounded-lg text-sm text-gray-700 hover:bg-gray-50",children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",disabled:V,className:"px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors disabled:opacity-60",children:V?"Guardando...":X?"Actualizar usuario":"Crear usuario"})]})]}),(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Listado"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Busca en todos los usuarios de la plataforma"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[(0,r.jsx)("input",{type:"search",value:H,onChange:e=>K(e.target.value),placeholder:"Buscar por nombre, email, rol o colegio",className:"w-full sm:w-72 px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200"}),j&&(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Cargando..."})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto max-h-[360px]",children:(0,r.jsxs)("table",{className:"min-w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-50 text-left text-gray-600",children:[(0,r.jsx)("th",{className:"px-3 py-2",children:"Nombre"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Email"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"RUT"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Rol"}),(0,r.jsx)("th",{className:"px-3 py-2",children:"Colegio"}),(0,r.jsx)("th",{className:"px-3 py-2 text-right",children:"Acciones"})]})}),(0,r.jsxs)("tbody",{className:"divide-y divide-gray-200",children:[e$.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-3 py-2 font-medium text-gray-900",children:e.name}),(0,r.jsx)("td",{className:"px-3 py-2 text-gray-700",children:e.email}),(0,r.jsx)("td",{className:"px-3 py-2 text-gray-700",children:e.rut||"—"}),(0,r.jsx)("td",{className:"px-3 py-2 text-gray-700",children:e.role}),(0,r.jsx)("td",{className:"px-3 py-2 text-gray-700",children:e.schoolName||e.schoolId}),(0,r.jsx)("td",{className:"px-3 py-2 text-right min-w-[160px]",children:(0,r.jsxs)("div",{className:"flex flex-wrap justify-end gap-2",children:[u&&(0,r.jsx)("button",{type:"button",onClick:()=>{Z(e),A({name:e.name,email:e.email,role:e.role,rut:e.rut||"",schoolId:e.schoolId,schoolName:e.schoolName||""})},className:"text-xs px-3 py-1 rounded-lg border border-primary text-primary hover:bg-primary/10",children:"Editar"}),p&&(0,r.jsx)("button",{type:"button",onClick:()=>eJ(e),className:"text-xs px-3 py-1 rounded-lg border border-red-300 text-red-600 hover:bg-red-50",children:"Eliminar"})]})})]},e.id)),!v.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{className:"px-3 py-3 text-gray-500",colSpan:6,children:"No hay usuarios a\xfan."})}),v.length>0&&!eX.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{className:"px-3 py-3 text-gray-500",colSpan:6,children:"Sin coincidencias para la b\xfasqueda."})})]})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-3 text-sm text-gray-600",children:[(0,r.jsx)("button",{type:"button",onClick:()=>eT(e=>Math.max(1,e-1)),disabled:eU<=1,className:"px-3 py-1.5 border border-gray-300 rounded-lg disabled:opacity-50",children:"Anterior"}),(0,r.jsxs)("span",{children:["P\xe1gina ",eU," de ",eZ," (",eX.length," usuario(s))"]}),(0,r.jsx)("button",{type:"button",onClick:()=>eT(e=>Math.min(eZ,e+1)),disabled:eU>=eZ,className:"px-3 py-1.5 border border-gray-300 rounded-lg disabled:opacity-50",children:"Siguiente"})]})]})]})}),(0,r.jsx)(c.u_,{isOpen:ev&&h,title:"Colegios",onClose:()=>ey(!1),cancelText:"Cerrar",size:"xl",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Gestiona identificadores, nombre y logos"}),C&&(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Cargando colegios..."})]}),(0,r.jsxs)("form",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 border border-gray-100 rounded-lg p-4",onSubmit:eq,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID"}),(0,r.jsx)("input",{type:"text",value:E.id,onChange:e=>R(a=>({...a,id:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",placeholder:"ej: school-123",required:!0})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),(0,r.jsx)("input",{type:"text",value:E.name,onChange:e=>R(a=>({...a,name:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"A\xf1o actual (opcional)"}),(0,r.jsx)("input",{type:"text",value:E.currentYear,onChange:e=>R(a=>({...a,currentYear:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",placeholder:"2025"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Logo (URL)"}),(0,r.jsx)("input",{type:"text",value:E.logoUrl,onChange:e=>R(a=>({...a,logoUrl:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",placeholder:"https://ejemplo.com/logo.png"})]}),(0,r.jsxs)("div",{className:"md:col-span-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Logo (imagen)"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;return eA((null===(a=e.target.files)||void 0===a?void 0:a[0])||null)},className:"w-full text-sm"}),ek&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:ek.name})]}),(0,r.jsx)("div",{className:"md:col-span-3 flex justify-end",children:(0,r.jsx)("button",{type:"submit",disabled:B,className:"px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors disabled:opacity-60",children:B?"Guardando...":"Crear colegio"})})]}),(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-3",children:[(0,r.jsx)("h3",{className:"text-md font-semibold text-gray-900 mb-2",children:"Listado"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[f.map(e=>{var a;return(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-shadow flex items-center gap-3",children:[e.logoUrl?(0,r.jsx)("img",{src:e.logoUrl,alt:e.name,className:"w-10 h-10 rounded object-cover border"}):(0,r.jsx)("div",{className:"w-10 h-10 rounded bg-gray-100 flex items-center justify-center text-sm font-semibold text-gray-700",children:(null===(a=e.name)||void 0===a?void 0:a.charAt(0))||"?"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:e.id}),e.currentYear&&(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["A\xf1o: ",e.currentYear]})]}),(0,r.jsx)("button",{type:"button",className:"text-xs text-primary hover:underline",onClick:()=>{T(e),eI(!0)},children:"Editar"})]},e.id)}),!f.length&&(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"No hay colegios registrados."})]})]})]})}),(0,r.jsx)(c.u_,{isOpen:ej,title:"Importar usuarios (CSV)",onClose:()=>eN(!1),cancelText:"Cerrar",size:"lg",children:(0,r.jsxs)("form",{className:"space-y-4",onSubmit:eF,children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Cabeceras requeridas: ",(0,r.jsx)("strong",{children:"name, email, role, rut"}),". Los usuarios se asociar\xe1n al colegio seleccionado."]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Archivo CSV"}),(0,r.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:e=>{var a;return eW((null===(a=e.target.files)||void 0===a?void 0:a[0])||null)},className:"w-full text-sm"}),D.fileName&&(0,r.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:[D.fileName," • ",D.rows," fila(s)"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Colegio destino"}),h?(0,r.jsxs)("select",{value:k.schoolId,onChange:e=>A(a=>({...a,schoolId:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200 bg-white",children:[(0,r.jsx)("option",{value:"",children:"Selecciona colegio"}),f.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," (",e.id,")"]},e.id))]}):(0,r.jsx)("input",{type:"text",value:(null==e?void 0:e.schoolName)||(null==e?void 0:e.schoolId)||"",disabled:!0,className:"w-full px-3 py-2 border rounded-lg text-sm bg-gray-100 text-gray-600"})]}),h&&(0,r.jsxs)("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del colegio (si es nuevo)"}),(0,r.jsx)("input",{type:"text",value:k.schoolName,onChange:e=>{let a=e.target.value;A(e=>({...e,schoolName:a})),R(e=>({...e,name:a}))},className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",placeholder:"Solo si no existe"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Crear colegio con ID"}),(0,r.jsx)("input",{type:"text",value:E.id,onChange:e=>R(a=>({...a,id:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",placeholder:"Opcional"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Se crear\xe1n usuarios v\xe1lidos; filas vac\xedas se omiten."}),(0,r.jsx)("button",{type:"submit",disabled:M,className:"px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors disabled:opacity-60",children:M?"Importando...":"Importar usuarios"})]})]})}),(0,r.jsx)(c.u_,{isOpen:eC,title:"Importar estudiantes (CSV)",onClose:()=>ew(!1),cancelText:"Cerrar",size:"xl",children:(0,r.jsxs)("form",{className:"space-y-4",onSubmit:eG,children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Encabezados esperados: A\xf1o, Curso, RUN, Genero, Nombres, Apellido Paterno, Apellido Materno, Direccion, Comuna Residencia, Email, Celular."}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Colegio destino"}),(0,r.jsxs)("select",{value:ei,onChange:e=>en(e.target.value),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200",children:[(0,r.jsx)("option",{value:"",children:"Selecciona colegio"}),f.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," (",e.id,")"]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Archivo CSV"}),(0,r.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:e=>{var a;return eo((null===(a=e.target.files)||void 0===a?void 0:a[0])||null)},className:"w-full text-sm"}),et&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:et.name})]})]}),(0,r.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,r.jsx)("button",{type:"submit",disabled:ex,className:"px-4 py-2 rounded-lg text-white font-semibold ".concat(ex?"bg-primary/70":"bg-primary hover:bg-primary-dark"," transition-colors"),children:ex?"Importando...":"Importar estudiantes"}),(0,r.jsx)(t.default,{href:"/management/students",className:"text-sm text-primary hover:text-green-800 underline",children:"Ver estudiantes"})]}),er&&(0,r.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 text-red-700 text-sm rounded-lg",children:er}),ea&&(0,r.jsxs)("div",{className:"p-3 bg-primary/10 border border-primary/30 text-primary text-sm rounded-lg space-y-1",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Procesadas:"})," ",ea.processed," • ",(0,r.jsx)("strong",{children:"Creadas:"})," ",ea.created," •"," ",(0,r.jsx)("strong",{children:"Actualizadas:"})," ",ea.updated]}),ea.errors&&ea.errors.length>0&&(0,r.jsxs)("details",{className:"text-amber-800",children:[(0,r.jsxs)("summary",{className:"cursor-pointer",children:["Errores (",ea.errors.length,")"]}),(0,r.jsx)("ul",{className:"list-disc list-inside",children:ea.errors.map((e,a)=>(0,r.jsx)("li",{children:e},a))})]})]})]})}),(0,r.jsx)(c.u_,{isOpen:ef,title:"Pol\xedtica de IA",onClose:()=>eb(!1),cancelText:"Cerrar",size:"xl",children:(0,r.jsxs)("form",{className:"space-y-4",onSubmit:eB,children:[ed&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Cargando pol\xedtica..."}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prompt de reescritura"}),(0,r.jsx)("textarea",{value:$.rewritePrompt,onChange:e=>ee(a=>({...a,rewritePrompt:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200 min-h-[140px]",placeholder:eD}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Placeholders: ","{tone}",", ","{texto}"," / ","{text}",". Se inserta autom\xe1ticamente seg\xfan el mensaje."]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reglas de moderaci\xf3n"}),(0,r.jsx)("textarea",{value:$.moderationRules,onChange:e=>ee(a=>({...a,moderationRules:e.target.value})),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200 min-h-[120px]",placeholder:eL}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Una regla por l\xednea. La IA marcar\xe1 como sensible si detecta estos temas."})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:$.updatedBy&&(0,r.jsxs)("span",{children:["\xdaltima edici\xf3n por ",$.updatedBy," ",$.updatedAt?"(".concat(new Date($.updatedAt).toLocaleString(),")"):""]})}),eE&&(0,r.jsx)("div",{className:"text-xs text-green-700 bg-green-50 border border-green-200 rounded-lg px-3 py-2",children:eE}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>ee({rewritePrompt:eD,moderationRules:eL,updatedBy:$.updatedBy,updatedAt:$.updatedAt}),className:"px-4 py-2 border border-gray-300 text-gray-800 rounded-lg text-sm hover:border-primary hover:text-primary",children:"Restablecer valores sugeridos"}),(0,r.jsx)("button",{type:"submit",disabled:eu,className:"px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors disabled:opacity-60",children:eu?"Guardando...":"Guardar pol\xedtica"})]})]})]})}),(0,r.jsx)(c.u_,{isOpen:!!W,title:"Confirmar eliminaci\xf3n",onClose:()=>F(null),onConfirm:eQ,confirmText:J?"Eliminando...":"Eliminar usuario",children:(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:["\xbfSeguro que deseas eliminar al usuario"," ",(0,r.jsx)("span",{className:"font-semibold",children:(null==W?void 0:W.name)||(null==W?void 0:W.email)||"sin nombre"}),"? Esta acci\xf3n no se puede deshacer."]})}),(0,r.jsx)(c.u_,{isOpen:eS&&!!U,title:"Editar colegio",onClose:()=>{eI(!1),T(null)},onConfirm:async()=>{if(U){G(!0),I("");try{await i.x.updateSchool(U.id,{name:U.name,currentYear:U.currentYear,logoUrl:U.logoUrl}),await eM(),eI(!1),T(null)}catch(l){var e,a,s,r;I((null==l?void 0:null===(a=l.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||(null==l?void 0:null===(r=l.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||(null==l?void 0:l.message)||"No se pudo actualizar el colegio")}finally{G(!1)}}},confirmText:B?"Guardando...":"Guardar cambios",children:U&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),(0,r.jsx)("input",{type:"text",value:U.name,onChange:e=>T({...U,name:e.target.value}),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"A\xf1o actual"}),(0,r.jsx)("input",{type:"text",value:U.currentYear||"",onChange:e=>T({...U,currentYear:e.target.value}),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Logo (URL)"}),(0,r.jsx)("input",{type:"text",value:U.logoUrl||"",onChange:e=>T({...U,logoUrl:e.target.value}),className:"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent border-gray-200"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Logo (archivo)"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;return P((null===(a=e.target.files)||void 0===a?void 0:a[0])||null)},className:"w-full text-sm"}),O&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:O.name}),(0,r.jsx)("button",{type:"button",onClick:eH,disabled:B||!O,className:"mt-2 px-3 py-1.5 bg-primary text-white rounded-lg text-sm disabled:opacity-60",children:B?"Subiendo...":"Subir logo"})]})]})})]}):(0,r.jsx)(o.I,{children:(0,r.jsxs)("div",{className:"glass-panel rounded-2xl p-6 soft-shadow",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Sin permisos"}),(0,r.jsx)("p",{className:"text-gray-600",children:"No tienes permisos para acceder a configuraci\xf3n."})]})})}}},function(e){e.O(0,[502,619,648,785,255,462,971,117,744],function(){return e(e.s=2965)}),_N_E=e.O()}]);