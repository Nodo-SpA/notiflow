(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{6014:function(e,s,t){Promise.resolve().then(t.bind(t,1720))},1720:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var a=t(7437),l=t(7648),r=t(1994),i=t(2840),n=t(2265),o=t(7855),d=t(2449),c=t(1469);function m(){let{year:e}=(0,d.GL)(),s=new Date().getFullYear().toString(),t=e||s,m=(0,d.tN)(e=>e.hasPermission),x=(0,d.tN)(e=>e.user),h="teacher"===((null==x?void 0:x.role)||"").toLowerCase(),u=m("messages.create"),g=h||m("messages.list"),p=m("reports.view"),f=!h&&m("users.list"),v=m("students.list")||m("students.create")||m("students.update")||m("students.delete"),j="superadmin"===((null==x?void 0:x.role)||"").toLowerCase()||m("*"),[b,y]=(0,n.useState)([]),[N,w]=(0,n.useState)(0),[E,M]=(0,n.useState)([]),[S,C]=(0,n.useState)([]),[A,P]=(0,n.useState)(0),[k,L]=(0,n.useState)({}),[_,U]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{U(!0);try{var e,s,a,l,r,i;let n=o.x.getMessages({year:t}),d=f?o.x.getUsers():Promise.resolve({data:[]}),c=v?o.x.getStudents({page:1,pageSize:1,year:t}):Promise.resolve({data:{items:[],total:0}}),m=j?o.x.getSchools():Promise.resolve({data:[]}),x=j?o.x.getUsageMetrics():Promise.resolve({data:{}}),[h,u,g,p,b]=await Promise.all([n,d,c,m,x]),N=h.data||{},E=null!==(l=null!==(a=N.items)&&void 0!==a?a:N)&&void 0!==l?l:[];y(E);let S="number"==typeof N.total?N.total:Array.isArray(E)?E.length:0;w(S),M(u.data||[]);let A=g.data||{},k=null!==(i=null!==(r=A.total)&&void 0!==r?r:null===(e=A.items)||void 0===e?void 0:e.length)&&void 0!==i?i:0;P(k),C((p.data||[]).map(e=>({id:e.id,name:e.name})));let _=(null===(s=b.data)||void 0===s?void 0:s.appActiveBySchool)||{};L(_)}catch(e){}finally{U(!1)}})()},[t,f,j]);let D=(0,n.useMemo)(()=>{let e=[{label:"Mensajes ".concat(t),value:N}];return v&&e.push({label:"Estudiantes ".concat(t),value:A}),f&&(e.push({label:"Usuarios",value:E.length}),e.push({label:"Admins",value:E.filter(e=>"admin"===(e.role||"").toLowerCase()).length})),e},[N,E,f,v,A,t]),R=(0,n.useMemo)(()=>{if(!j)return[];let e=new Map,s=new Map,t=new Map,a=new Map;E.forEach(t=>{let a=t.schoolId||"desconocido";e.set(a,(e.get(a)||0)+1),"admin"===(t.role||"").toLowerCase()&&s.set(a,(s.get(a)||0)+1)}),b.forEach(e=>{let s=e.schoolId||"desconocido";t.set(s,(t.get(s)||0)+1)}),Object.entries(k||{}).forEach(e=>{let[s,t]=e;a.set(s,(a.get(s)||0)+Number(t))});let l=new Map;return S.forEach(e=>l.set(e.id,e.name)),e.forEach((e,s)=>{l.has(s)||l.set(s,"Colegio ".concat(s))}),t.forEach((e,s)=>{l.has(s)||l.set(s,"Colegio ".concat(s))}),a.forEach((e,s)=>{l.has(s)||l.set(s,"Colegio ".concat(s))}),Array.from(l.entries()).map(l=>{let[r,i]=l;return{id:r,name:i,users:e.get(r)||0,admins:s.get(r)||0,messages:t.get(r)||0,appActive:a.get(r)||0}})},[j,E,b,S,k]),z=[u?{title:"Enviar Nuevo Mensaje",description:"Crea y env\xeda un mensaje a estudiantes, cursos o niveles",href:"/messages/new",color:"from-primary to-primary-dark",icon:c.LbG}:null,g?{title:"Mis Mensajes",description:"Revisa el historial de mensajes enviados",href:"/messages",color:"from-blue-500 to-blue-600",icon:c.hbr}:null,p?{title:"Reportes",description:"Revisa m\xe9tricas y desempe\xf1o",href:"/reports",color:"from-secondary to-secondary/90",icon:c.DKx}:null,{title:"Eventos",description:"Crea o revisa eventos y evaluaciones",href:"/events",color:"from-emerald-500 to-emerald-600",icon:c.DKx}].filter(Boolean);return(0,a.jsx)(i.I,{children:(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Panel general"}),(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Gestiona tu comunicaci\xf3n escolar de forma centralizada"})]}),u&&(0,a.jsx)(l.default,{href:"/messages/new",className:"inline-flex items-center justify-center rounded-lg bg-primary px-5 py-2.5 text-white font-medium hover:bg-primary-dark transition-colors",children:"+ Enviar mensaje"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 ".concat(D.length>=3?"md:grid-cols-3":"md:grid-cols-2"),children:D.map((e,s)=>(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm",children:[(0,a.jsx)("p",{className:"text-gray-600 text-sm font-medium",children:e.label}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:_?"—":e.value})]},s))}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Acciones R\xe1pidas"})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:z.map((e,s)=>(0,a.jsxs)(l.default,{href:e.href,className:(0,r.Z)("rounded-2xl p-6 bg-gradient-to-r text-white hover:translate-y-[-3px] transition transform soft-shadow group",e.color),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsx)("div",{className:"p-3 rounded-lg text-white flex items-center justify-center shadow-inner bg-white/20",children:(0,a.jsx)(e.icon,{size:20})}),(0,a.jsx)("div",{className:"text-white/70 group-hover:text-white transition-colors text-lg",children:"→"})]}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:e.title}),(0,a.jsx)("p",{className:"text-white/80 text-sm",children:e.description})]},s))})]}),j&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Visi\xf3n por colegio"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Solo visible para Superadmin"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[R.map(e=>(0,a.jsxs)("div",{className:"glass-panel rounded-2xl p-5 soft-shadow",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:e.id}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-secondary mb-3",children:e.name}),(0,a.jsxs)("div",{className:"space-y-2 text-sm text-gray-700",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Usuarios"}),(0,a.jsx)("span",{className:"font-bold",children:_?"—":e.users})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Admins"}),(0,a.jsx)("span",{className:"font-bold",children:_?"—":e.admins})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["Mensajes ",t]}),(0,a.jsx)("span",{className:"font-bold",children:_?"—":e.messages})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Usuarios activos en la app (\xfaltimos 30 d\xedas)"}),(0,a.jsx)("span",{className:"font-bold",children:_?"—":e.appActive})]})]})]},e.id)),0===R.length&&(0,a.jsx)("div",{className:"glass-panel rounded-2xl p-5 text-sm text-gray-500 text-center",children:"No hay datos de colegios a\xfan."})]})]})]})})}}},function(e){e.O(0,[502,619,648,785,255,462,971,117,744],function(){return e(e.s=6014)}),_N_E=e.O()}]);